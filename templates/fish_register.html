{% extends "base.html" %}

{% block content %}

<style>
.register-page {
    min-height: 100vh;
    background: linear-gradient(180deg, #0a1628 0%, #0d2137 60%, #0a1628 100%);
    padding-bottom: 100px;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.reg-header {
    background: linear-gradient(135deg, #1a3a5c, #0d2137);
    border-bottom: 2px solid #1e5a8a;
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: sticky;
    top: 0;
    z-index: 10;
}
.reg-back {
    color: #7dd3fc;
    text-decoration: none;
    font-size: 22px;
    line-height: 1;
}
.reg-header-title {
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-size: 18px;
    font-weight: 900;
    color: #7dd3fc;
    letter-spacing: 2px;
}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.reg-form {
    padding: 20px 16px;
}

/* å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */
.photo-upload-area {
    width: 100%;
    height: 200px;
    background: rgba(26,58,92,0.4);
    border: 2px dashed #1e5a8a;
    border-radius: 14px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    overflow: hidden;
    position: relative;
    transition: border-color 0.2s;
}
.photo-upload-area:hover {
    border-color: #0ea5e9;
}
.photo-upload-area.has-photo {
    border-style: solid;
    border-color: #0ea5e9;
}
.photo-preview {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
}
.photo-placeholder {
    text-align: center;
    color: #4a7fa5;
}
.photo-placeholder .icon { font-size: 44px; margin-bottom: 8px; }
.photo-placeholder .text { font-size: 13px; }
#photo-input { display: none; }

/* å¤‰æ›´ãƒœã‚¿ãƒ³ */
.photo-change-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(13,33,55,0.85);
    border: 1px solid #1e5a8a;
    color: #7dd3fc;
    font-size: 11px;
    padding: 4px 10px;
    border-radius: 6px;
    cursor: pointer;
    display: none;
}

/* ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
.form-group {
    margin-bottom: 16px;
}
.form-label {
    display: block;
    font-size: 12px;
    color: #7dd3fc;
    font-weight: 700;
    margin-bottom: 6px;
    letter-spacing: 1px;
}
.form-input {
    width: 100%;
    padding: 13px 14px;
    border-radius: 10px;
    background: rgba(26,58,92,0.5);
    border: 1px solid #1e5a8a;
    color: #e2f4ff;
    font-size: 15px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    box-sizing: border-box;
    outline: none;
    transition: border-color 0.2s;
}
.form-input:focus {
    border-color: #0ea5e9;
}
.form-input::placeholder { color: #4a7fa5; }

/* AIèª¬æ˜ */
.ai-notice {
    background: rgba(14,165,233,0.1);
    border: 1px solid rgba(14,165,233,0.3);
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 20px;
    font-size: 12px;
    color: #7dd3fc;
    line-height: 1.7;
}
.ai-notice .ai-icon { font-size: 18px; margin-bottom: 6px; }

/* é€ä¿¡ãƒœã‚¿ãƒ³ */
.submit-btn {
    width: 100%;
    padding: 15px;
    border-radius: 12px;
    background: linear-gradient(135deg, #0ea5e9, #0284c7);
    border: none;
    color: #fff;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-size: 17px;
    font-weight: 900;
    cursor: pointer;
    letter-spacing: 1px;
    box-shadow: 0 4px 0 #0369a1;
    transition: all 0.15s ease;
    position: relative;
}
.submit-btn:active {
    transform: translateY(3px);
    box-shadow: 0 1px 0 #0369a1;
}
.submit-btn:disabled {
    background: #1e5a8a;
    color: #4a7fa5;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
.loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(10,22,40,0.85);
    z-index: 999;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
}
.loading-overlay.active { display: flex; }
.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #1e5a8a;
    border-top-color: #7dd3fc;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text {
    color: #7dd3fc;
    font-size: 14px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-weight: 700;
    text-align: center;
    line-height: 1.7;
}

/* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ */
.flash-msg {
    margin: 12px 16px 0;
    padding: 10px 14px;
    border-radius: 10px;
    font-size: 13px;
    font-weight: 700;
}
.flash-error { background: #7f1d1d33; color: #f87171; border: 1px solid #f8717155; }
</style>

<!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div class="loading-overlay" id="loading-overlay">
    <div style="font-size:40px;">ğŸ”</div>
    <div class="loading-spinner"></div>
    <div class="loading-text">
        AIãŒé­šã‚’åˆ†æä¸­ã§ã™â€¦<br>
        å±é™ºåº¦ãƒ»ãƒ¬ã‚¢åº¦ã‚’èª¿ã¹ã¦ã„ã¾ã™
    </div>
</div>

<div class="register-page">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="reg-header">
        <a href="{{ url_for('fish_log.index') }}" class="reg-back">â€¹</a>
        <div class="reg-header-title">ï¼‹ é‡£ã‚ŒãŸé­šã‚’ç™»éŒ²</div>
    </div>

    <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
    <div class="flash-msg flash-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endwith %}

    <form class="reg-form" method="POST" enctype="multipart/form-data" id="register-form"
          onsubmit="showLoading()">

        <!-- å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <div class="photo-upload-area" id="upload-area" onclick="document.getElementById('photo-input').click()">
            <img class="photo-preview" id="photo-preview" alt="preview">
            <div class="photo-placeholder" id="photo-placeholder">
                <div class="icon">ğŸ“·</div>
                <div class="text">ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’é¸æŠ<br><span style="font-size:11px; color:#4a7fa5;">â€»ä»»æ„</span></div>
            </div>
            <div class="photo-change-btn" id="change-btn" onclick="event.stopPropagation(); document.getElementById('photo-input').click()">
                ğŸ“· å¤‰æ›´
            </div>
        </div>
        <input type="file" id="photo-input" name="photo" accept="image/*" onchange="previewPhoto(this)">

        <!-- é­šã®åå‰ -->
        <div class="form-group">
            <label class="form-label" for="fish_name">ğŸŸ é­šã®åå‰ <span style="color:#f87171;">*</span></label>
            <input class="form-input" type="text" id="fish_name" name="fish_name"
                   placeholder="ä¾‹ï¼šãƒãƒ€ã‚¤ã€ã‚¹ã‚ºã‚­ã€ãƒ–ãƒ©ãƒƒã‚¯ãƒã‚¹â€¦"
                   required autocomplete="off">
        </div>

        <!-- ã‚µã‚¤ã‚º -->
        <div class="form-group">
            <label class="form-label" for="size_cm">ğŸ“ ã‚µã‚¤ã‚ºï¼ˆcmï¼‰ <span style="color:#f87171;">*</span></label>
            <input class="form-input" type="number" id="size_cm" name="size_cm"
                   placeholder="ä¾‹ï¼š45" step="0.1" min="1" max="999" required>
        </div>

        <!-- AIåˆ†æèª¬æ˜ -->
        <div class="ai-notice">
            <div class="ai-icon">ğŸ¤–</div>
            ç™»éŒ²ã™ã‚‹ã¨ <strong>AI</strong> ãŒè‡ªå‹•ã§åˆ†æã—ã¾ã™<br>
            âœ¦ å±é™ºåº¦ï¼ˆ5æ®µéšï¼‰<br>
            âœ¦ ãƒ¬ã‚¢åº¦ â˜…ã€œâ˜…â˜…â˜…â˜…â˜…<br>
            âœ¦ ç‰¹å¾´ãƒ»ç”Ÿæ¯åœ°
        </div>

        <!-- é€ä¿¡ -->
        <button type="submit" class="submit-btn" id="submit-btn">
            ğŸŸ ç™»éŒ²ã—ã¦AIåˆ†æã™ã‚‹
        </button>

    </form>
</div>

<script>
function previewPhoto(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const preview = document.getElementById('photo-preview');
        const placeholder = document.getElementById('photo-placeholder');
        const area = document.getElementById('upload-area');
        const changeBtn = document.getElementById('change-btn');
        preview.src = e.target.result;
        preview.style.display = 'block';
        placeholder.style.display = 'none';
        area.classList.add('has-photo');
        changeBtn.style.display = 'block';
    };
    reader.readAsDataURL(file);
}

function showLoading() {
    const btn = document.getElementById('submit-btn');
    const overlay = document.getElementById('loading-overlay');
    btn.disabled = true;
    overlay.classList.add('active');
}
</script>

{% endblock %}