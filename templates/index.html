{% extends "base.html" %}

{% block bottom_nav %}{% endblock %}

{% block content %}

<!-- ===== ã“ã“ã‹ã‚‰è¿½åŠ ï¼šã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”»é¢ ===== -->
<div id="splash-screen" style="
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    transition: opacity 0.8s ease, transform 0.8s ease;
">
    <!-- èƒŒæ™¯ -->
    <div style="
        position: absolute; inset: 0;
        background: radial-gradient(ellipse at 50% 100%, #0a2a4a 0%, transparent 60%),
                    radial-gradient(ellipse at 20% 60%, #0d4f7c 0%, transparent 50%),
                    linear-gradient(180deg, #0a1628 0%, #0d3a5c 30%, #0d6e9e 60%, #1a9fd4 80%, #87ceeb 100%);
    "></div>

    <!-- ã‚ªãƒ¼ãƒ­ãƒ© -->
    <div style="
        position: absolute; top: 0; left: 0; right: 0; height: 40%;
        background: radial-gradient(ellipse at 50% -20%, rgba(0,255,180,0.3) 0%, transparent 60%),
                    radial-gradient(ellipse at 30% -10%, rgba(0,212,255,0.2) 0%, transparent 50%);
        animation: aurora-pulse 4s ease-in-out infinite;
    "></div>

    <!-- æ³¢ -->
    <div class="splash-wave wave1"></div>
    <div class="splash-wave wave2"></div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div style="position:relative; z-index:10; display:flex; flex-direction:column; align-items:center; gap:1.5rem; padding:2rem; text-align:center;">

        <!-- é‡‘è‰²ã‚¨ãƒ³ãƒ–ãƒ¬ãƒ  -->
        <div style="
            width:80px; height:80px; border-radius:50%;
            background: radial-gradient(circle, #f5c842, #c49a1a);
            border: 4px solid #fff;
            display:flex; align-items:center; justify-content:center;
            font-size:2.5rem;
            box-shadow: 0 0 40px rgba(245,200,66,0.7);
            animation: emblem-glow 2s ease-in-out infinite;
        ">ğŸ£</div>

        <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
        <div>
            <div style="
                font-family: 'M PLUS Rounded 1c', 'Hiragino Maru Gothic Pro', sans-serif;
                font-weight: 900;
                font-size: clamp(2.5rem, 10vw, 4rem);
                line-height: 1.1;
                color: #fff;
                text-shadow: 0 0 20px rgba(0,212,255,0.8), 3px 3px 0 #0a2a4a;
                animation: title-in 0.8s ease-out both;
            ">
                é‡£ã‚ŠãŸã¾<span style="color:#f5c842; text-shadow: 0 0 20px rgba(245,200,66,0.9), 3px 3px 0 #5a3a00;">GO!!</span>
            </div>
            <div style="
                font-size: clamp(0.8rem, 3vw, 1rem);
                color: rgba(255,255,255,0.7);
                letter-spacing: 0.2em;
                margin-top:0.4rem;
                animation: title-in 0.8s ease-out 0.3s both;
            ">ã€œ ç©ºã®é‡£ã‚Šå†’é™º ã€œ</div>
        </div>

        <!-- åŒºåˆ‡ã‚Š -->
        <div style="display:flex; align-items:center; gap:1rem; color:#f5c842; animation: title-in 0.8s ease-out 0.5s both;">
            <div style="width:60px; height:2px; background:linear-gradient(90deg,transparent,#f5c842,transparent);"></div>
            ğŸŸ
            <div style="width:60px; height:2px; background:linear-gradient(90deg,transparent,#f5c842,transparent);"></div>
        </div>

        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
        <button onclick="showLogin()" id="start-btn" style="
            padding: 1rem 3rem;
            font-family: 'M PLUS Rounded 1c', 'Hiragino Maru Gothic Pro', sans-serif;
            font-weight: 900;
            font-size: clamp(1.1rem, 4vw, 1.4rem);
            color: #0a2a4a;
            background: linear-gradient(135deg, #f5c842 0%, #ffd700 40%, #f5c842 60%, #c49a1a 100%);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            letter-spacing: 0.1em;
            box-shadow: 0 8px 0 #8a6a00, 0 10px 30px rgba(245,200,66,0.5);
            transition: all 0.15s ease;
            animation: title-in 0.8s ease-out 0.8s both;
            position: relative;
            overflow: hidden;
        ">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>

        <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
        <div id="login-form" style="display:none; width:100%; max-width:300px; animation: title-in 0.5s ease-out both;">
            <input id="login-username" type="text" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" style="
                width:100%; padding:12px 16px; margin-bottom:10px;
                border-radius:12px; border:2px solid #f5c842;
                background:rgba(255,255,255,0.15); color:#fff;
                font-size:16px; font-family:'M PLUS Rounded 1c',sans-serif;
                outline:none; box-sizing:border-box;
            ">
            <input id="login-password" type="password" placeholder="åˆè¨€è‘‰ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰" style="
                width:100%; padding:12px 16px; margin-bottom:10px;
                border-radius:12px; border:2px solid #f5c842;
                background:rgba(255,255,255,0.15); color:#fff;
                font-size:16px; font-family:'M PLUS Rounded 1c',sans-serif;
                outline:none; box-sizing:border-box;
            ">
            <button onclick="doLogin()" style="
                width:100%; padding:12px;
                background:linear-gradient(135deg,#f5c842,#c49a1a);
                border:none; border-radius:12px;
                color:#0a2a4a; font-size:18px; font-weight:900;
                cursor:pointer; margin-bottom:8px;
                font-family:'M PLUS Rounded 1c',sans-serif;
            ">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button onclick="showRegister()" style="
                width:100%; padding:10px;
                background:transparent;
                border:2px solid #f5c842; border-radius:12px;
                color:#f5c842; font-size:14px; font-weight:700;
                cursor:pointer;
                font-family:'M PLUS Rounded 1c',sans-serif;
            ">æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰</button>
            <div id="login-error" style="color:#f87171; font-size:13px; margin-top:8px; text-align:center;"></div>
        </div>
    </div>
</div>

<style>
/* ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
@keyframes aurora-pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}
@keyframes emblem-glow {
    0%, 100% { box-shadow: 0 0 30px rgba(245,200,66,0.6); }
    50% { box-shadow: 0 0 60px rgba(245,200,66,0.9); }
}
@keyframes title-in {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes wave-anim {
    0%, 100% { transform: translateX(0) scaleY(1); }
    50% { transform: translateX(-5%) scaleY(1.1); }
}
.splash-wave {
    position: absolute;
    bottom: 0; left: -50%;
    width: 200%; height: 180px;
    border-radius: 50% 50% 0 0;
}
.wave1 {
    background: linear-gradient(180deg, #1a7abf 0%, #0d4f7c 100%);
    opacity: 0.6;
    animation: wave-anim 6s ease-in-out infinite;
    bottom: -20px;
}
.wave2 {
    background: linear-gradient(180deg, #00d4ff 0%, #1a7abf 100%);
    opacity: 0.3;
    animation: wave-anim 4s ease-in-out infinite reverse;
    bottom: 10px;
}
#start-btn:hover {
    transform: translateY(-3px) !important;
    box-shadow: 0 11px 0 #8a6a00, 0 15px 40px rgba(245,200,66,0.7) !important;
}
#start-btn:active {
    transform: translateY(5px) !important;
    box-shadow: 0 3px 0 #8a6a00 !important;
}
#splash-screen.hidden {
    opacity: 0 !important;
    transform: scale(1.05) !important;
    pointer-events: none !important;
}
</style>

<script>
function startGame() {
    const splash = document.getElementById('splash-screen');
    splash.classList.add('hidden');
    setTimeout(() => {
        splash.style.display = 'none';
    }, 800);
}

// ä¸€åº¦ã‚¹ã‚¿ãƒ¼ãƒˆã—ãŸã‚‰æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆä»»æ„ï¼‰
// ã‚‚ã—æ¯å›ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚’å‡ºã—ãŸã„å ´åˆã¯ã“ã®éƒ¨åˆ†ã‚’å‰Šé™¤ã—ã¦OK
if (sessionStorage.getItem('splash_shown') || new URLSearchParams(window.location.search).get('skip_splash')) {
    document.getElementById('splash-screen').style.display = 'none';
}
sessionStorage.setItem('splash_shown', 'true');
// }
function showLogin() {
    document.getElementById('start-btn').style.display = 'none';
    document.getElementById('login-form').style.display = 'block';
}

function doLogin() {
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    if (!username || !password) {
        document.getElementById('login-error').textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨åˆè¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
        return;
    }
    fetch('/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`,
        redirect: 'follow'
    }).then(res => {
        if (res.url.includes('login')) {
            document.getElementById('login-error').textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹åˆè¨€è‘‰ãŒé•ã„ã¾ã™';
        } else {
            window.location.href = '/';
        }
    });
}

function showRegister() {
    window.location.href = '/auth/register';
}
</script>
<!-- ===== ã“ã“ã¾ã§è¿½åŠ ï¼šã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ç”»é¢ ===== -->


<!-- â†“â†“â†“ ä»¥ä¸‹ã¯å…ƒã®index.htmlã®ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ â†“â†“â†“ -->

<div class="header">
    <div class="sea-bg" style="background-image: url('{{ bg_image }}');"></div>
    <div class="header-content">
        <div class="title-banner">ğŸ£ é‡£ã‚ŠãŸã¾GO!!</div>
        <div class="user-info">
    <span class="username">å‹‡è€…ï¼š{% if current_user.is_authenticated %}{{ current_user.username }}{% else %}ã‚²ã‚¹ãƒˆ{% endif %}</span>
    <span class="badge-icon">ğŸ¡</span>
</div>
<div class="level-display">
    <span class="level-label">âœ¦ LEVEL âœ¦</span>
    <span class="level-number">{% if current_user.is_authenticated %}{{ current_user.level }}{% else %}?{% endif %}</span>
    <div class="level-bar">
        <div class="level-bar-fill"></div>
    </div>
</div>
    </div>
</div>

<div class="section-title">âš” å›³é‘‘ãƒ»çŸ¥è­˜ âš”</div>
<div class="menu-grid">
    <a href="/learn/tools" class="menu-item">
        <img src="{{ url_for('static', filename='images/tackle_box.png') }}" alt="é“å…·å›³é‘‘">
        <div class="menu-label">é“å…·å›³é‘‘</div>
    </a>
    <a href="/learn/conditions" class="menu-item">
        <img src="{{ url_for('static', filename='images/lake_day.png') }}" alt="é‡£ã‚Œã‚‹æ¡ä»¶">
        <div class="menu-label">é‡£ã‚Œã‚‹æ¡ä»¶</div>
    </a>
    <a href="/learn/spots" class="menu-item">
        <img src="{{ url_for('static', filename='images/map_icon.png') }}" alt="å ´æ‰€">
        <div class="menu-label">å ´æ‰€</div>
    </a>
    <a href="/learn/rules" class="menu-item">
        <img src="{{ url_for('static', filename='images/fishing_license.png') }}" alt="ãƒ«ãƒ¼ãƒ«">
        <div class="menu-label">ãƒ«ãƒ¼ãƒ«</div>
    </a>
</div>

<div class="catch-log">
    <div class="catch-log-title">ğŸ† ï½ ãƒ™ã‚¹ãƒˆã‚µã‚¤ã‚º ï½ ğŸ†</div>
    {% if best_catch %}
    <div style="text-align:center;">
        <div style="width:100%; max-height:220px; overflow:hidden; border-radius:12px; margin-bottom:12px;">
            {% if best_catch.photo_data %}
            <img src="{{ best_catch.photo_data }}" style="width:100%; height:220px; object-fit:cover; border-radius:12px;">
            {% else %}
            <div style="font-size:80px; line-height:220px;">ğŸŸ</div>
            {% endif %}
        </div>
        <p style="font-size:22px; font-weight:900; color:#1A237E; margin-bottom:4px;">{{ best_catch.fish_name }}</p>
        <p style="font-size:28px; font-weight:900; color:#2196F3;">ğŸ“ {{ best_catch.size_cm }} cm</p>
    </div>
    {% else %}
    <div class="catch-empty">
        ï½ ã¾ã é‡£æœãŒã‚ã‚Šã¾ã›ã‚“ ï½<br><br>
        ğŸ£ é‡£ã‚Šã«è¡Œã£ã¦<br>
        è¨˜éŒ²ã‚’ã¤ã‘ã‚ˆã†ï¼
    </div>
    {% endif %}
</div>

<div class="section-title">ğŸ… ã‚¯ã‚¨ã‚¹ãƒˆãƒ»æŒ‘æˆ¦ ğŸ…</div>
<div class="menu-grid">
    <a href="/fish" class="menu-item">
        <img src="{{ url_for('static', filename='images/fish_vintage.png') }}" alt="é­šå›³é‘‘">
        <div class="menu-label">é­šå›³é‘‘</div>
    </a>
    <a href="/mission/badges" class="menu-item">
        <img src="{{ url_for('static', filename='images/medal.png') }}" alt="ãƒãƒƒã‚¸">
        <div class="menu-label">ãƒãƒƒã‚¸</div>
    </a>
    <a href="/quests/" class="menu-item">
        <img src="{{ url_for('static', filename='images/gear_inventory.png') }}" alt="ã‚¯ã‚¨ã‚¹ãƒˆ">
        <div class="menu-label">ã‚¯ã‚¨ã‚¹ãƒˆ</div>
    </a>
    <a href="/learn/" class="menu-item">
        <img src="{{ url_for('static', filename='images/live_bait.png') }}" alt="é‡£ã®ä»•æ–¹">
        <div class="menu-label">é‡£ã®ä»•æ–¹</div>
    </a>
</div>



{% endblock %}